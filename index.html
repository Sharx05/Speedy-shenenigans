<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Speed Meme Notifier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .status-dot {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .5;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="max-w-2xl w-full mx-auto p-8 bg-gray-800 rounded-2xl shadow-2xl text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-cyan-400 mb-4">Internet Speed Meme Notifier</h1>
        <p class="text-gray-400 mb-8 text-lg">I'll check your internet speed every 30 seconds and play a custom sound.</p>

        <div id="start-screen">
            <div class="bg-gray-700/50 p-6 rounded-xl mb-8">
                <h2 class="text-xl font-bold text-white">Ready to Roast Your Wi-Fi?</h2>
                <p class="text-gray-400 mt-2">Click start to begin the monitoring.</p>
            </div>
            <button id="startButton" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-4 px-8 rounded-lg text-xl transition-all duration-300 shadow-lg hover:shadow-cyan-500/50">
                Start Monitoring
            </button>
        </div>

        <div id="monitoring-screen" class="hidden">
            <div class="mb-6">
                <div class="flex items-center justify-center gap-3">
                     <div id="status-indicator" class="flex items-center justify-center gap-2">
                        <div class="status-dot h-3 w-3 bg-green-400 rounded-full"></div>
                        <p class="text-green-400 text-lg">Monitoring Active</p>
                    </div>
                </div>
                 <p class="text-gray-500 text-sm mt-2">Next check is in <span id="timer">0:30</span></p>
            </div>
           
            <div class="bg-gray-900/50 p-6 rounded-xl border border-gray-700">
                <p class="text-gray-400 text-sm uppercase tracking-widest mb-2">Last Measured Speed</p>
                <div class="flex items-baseline justify-center">
                    <span id="speedDisplay" class="text-6xl font-bold text-white">--</span>
                    <span class="text-2xl text-gray-400 ml-2">Mbps</span>
                </div>
            </div>
            
            <div class="mt-6">
                <p class="text-gray-400 text-sm uppercase tracking-widest mb-2">Last Comment</p>
                <p id="lastComment" class="text-lg text-cyan-300 italic">"Waiting for the first check..."</p>
            </div>

            <button id="stopButton" class="mt-8 bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-300">
                Stop Monitoring
            </button>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const startScreen = document.getElementById('start-screen');
        const monitoringScreen = document.getElementById('monitoring-screen');
        const speedDisplay = document.getElementById('speedDisplay');
        const lastComment = document.getElementById('lastComment');
        const timerDisplay = document.getElementById('timer');

        // --- Configuration ---
        const checkInterval = 20 * 1000; // 20 seconds in milliseconds
        const imageURL = 'https://placehold.co/1000x1000/000000/FFFFFF?text=Test-File'; // A 1MB test file
        const imageSizeInBytes = 1000 * 1000; // The size of the file in bytes

        // --- CUSTOM AUDIO TIER CONFIGURATION ---
        // This is where you map speed ranges to your own audio files.
        // Upload your audio files (mp3, wav, etc.) to a hosting service and paste the direct links here.
        const speedTiers = [
            {
                minSpeed: 0,
                maxSpeed: 1,
                comment: "Are you serious right now?",
                // Replace with your own audio file URL
                audioSrc: "https://www.myinstants.com/media/sounds/erro.mp3" 
            },
            {
                minSpeed: 1,
                maxSpeed: 2,
                comment: "My grandma's dial-up was faster.",
                 // Replace with your own audio file URL
                audioSrc: "https://www.myinstants.com/media/sounds/sad-trombone.mp3"
            },
            {
                minSpeed: 2,
                maxSpeed: 4,
                comment: "It's... acceptable.",
                 // Replace with your own audio file URL
                audioSrc: "https://www.myinstants.com/media/sounds/wow_9.mp3"
            },
            {
                minSpeed: 4,
                maxSpeed: 6,
                comment: "Okay, now we're talking!",
                 // Replace with your own audio file URL
                audioSrc: "https://www.myinstants.com/media/sounds/nice-shot.mp3"
            },
            {
                minSpeed: 6,
                maxSpeed: Infinity, // Catches everything above 200
                comment: "UNLIMITED POWER!",
                 // Replace with your own audio file URL
                audioSrc: "https://www.myinstants.com/media/sounds/holy-moly-vine-sound-effect.mp3"
            }
        ];

        let speedCheckIntervalId = null;
        let countdownIntervalId = null;

        // --- Core Functions ---

        /**
         * Finds the correct tier configuration for a given speed.
         * @param {number} speedMbps - The measured speed in Mbps.
         * @returns {object|null} The matching tier object or null if not found.
         */
        function findTierForSpeed(speedMbps) {
            return speedTiers.find(tier => speedMbps >= tier.minSpeed && speedMbps < tier.maxSpeed);
        }

        /**
         * Plays the audio and updates the comment for a given speed.
         * @param {number} speedMbps - The measured speed in Mbps.
         */
        function playMemeAudio(speedMbps) {
            const tier = findTierForSpeed(speedMbps);
            if (!tier) {
                console.warn(`No audio tier found for speed: ${speedMbps} Mbps`);
                lastComment.textContent = "No comment for this speed.";
                return;
            }

            // Update the on-screen comment
            lastComment.textContent = `"${tier.comment}"`;

            // Play the audio file
            if (tier.audioSrc) {
                const audio = new Audio(tier.audioSrc);
                audio.play().catch(error => {
                    console.error("Error playing audio:", error);
                    // This can happen if the user hasn't interacted with the page yet.
                    lastComment.textContent = "Could not play audio. Please click the page and try again.";
                });
            }
        }

        /**
         * Measures the download speed by timing how long it takes to fetch a file.
         */
        async function measureSpeed() {
            try {
                speedDisplay.textContent = '...';
                const startTime = new Date().getTime();
                const response = await fetch(imageURL + '&t=' + startTime);
                await response.blob();
                const endTime = new Date().getTime();
                const durationInSeconds = (endTime - startTime) / 1000;
                
                if (durationInSeconds < 0.1) {
                    console.warn("Download was too fast to measure accurately. Assuming very high speed.");
                    updateUI(500);
                    return;
                }
                
                const speedBps = (imageSizeInBytes * 8) / durationInSeconds;
                const speedMbps = (speedBps / (1024 * 1024)).toFixed(2);
                updateUI(speedMbps);

            } catch (error) {
                console.error("Error measuring speed:", error);
                speedDisplay.textContent = 'Error';
                playMemeAudio(0); // Play the slowest tier audio on error
            }
        }

        /**
         * Updates the UI elements with the new speed and triggers the audio meme.
         * @param {number} speedMbps - The measured speed in Mbps.
         */
        function updateUI(speedMbps) {
            speedDisplay.textContent = speedMbps;
            playMemeAudio(speedMbps);
        }

        /**
         * Starts the countdown timer for the next check.
         */
        function startCountdown() {
            let timeLeft = checkInterval / 1000;
            const updateTimer = () => {
                const minutes = Math.floor(timeLeft / 60);
                let seconds = timeLeft % 60;
                seconds = seconds < 10 ? '0' + seconds : seconds;
                timerDisplay.textContent = `${minutes}:${seconds}`;
                timeLeft--;
                if (timeLeft < 0) {
                    timeLeft = (checkInterval / 1000) - 1; // Reset for the next interval
                }
            };
            updateTimer();
            countdownIntervalId = setInterval(updateTimer, 1000);
        }

        // --- Event Listeners & Initial Setup ---

        startButton.addEventListener('click', () => {
            console.log("Starting monitoring...");
            startScreen.classList.add('hidden');
            monitoringScreen.classList.remove('hidden');
            measureSpeed();
            speedCheckIntervalId = setInterval(measureSpeed, checkInterval);
            startCountdown();
        });

        stopButton.addEventListener('click', () => {
            console.log("Stopping monitoring.");
            if (speedCheckIntervalId) clearInterval(speedCheckIntervalId);
            if (countdownIntervalId) clearInterval(countdownIntervalId);
            speedCheckIntervalId = null;
            countdownIntervalId = null;
            startScreen.classList.remove('hidden');
            monitoringScreen.classList.add('hidden');
            speedDisplay.textContent = '--';
            lastComment.textContent = '"Monitoring paused."';
        });

    </script>
</body>
</html>
